#!/usr/bin/env php
<?php declare(strict_types=1);
// Copyright (C) 2015-2025 Mark Constable <mc@netserva.org> (MIT License)
// CLI wrapper for VmailOps::hashPassword - same code as web UI

if (php_sapi_name() !== 'cli') {
    die("CLI only\n");
}

require __DIR__ . '/../vendor/autoload.php';

use SPE\HCP\Lib\VmailOps;

if ($argc < 3) {
    fwrite(STDERR, "Usage: chvmail <email> <password> [host]\n");
    exit(1);
}

$email = $argv[1];
$password = $argv[2];
$host = $argv[3] ?? null;

if ($host) {
    putenv("TARGET_HOST={$host}");
}

$hash = VmailOps::hashPassword($password);

echo "Email: {$email}\n";
echo "Hash: {$hash}\n";
exit(0);
