#!/usr/bin/env php
<?php declare(strict_types=1);
// Copyright (C) 2015-2025 Mark Constable <mc@netserva.org> (MIT License)
// CLI wrapper for VhostOps::show - same code as web UI

if (php_sapi_name() !== 'cli') {
    die("CLI only\n");
}

require __DIR__ . '/../vendor/autoload.php';

use SPE\HCP\Lib\VhostOps;

if ($argc < 2) {
    fwrite(STDERR, "Usage: shvhost <domain> [host]\n");
    exit(1);
}

$domain = $argv[1];
$host = $argv[2] ?? null;

if ($host) {
    putenv("TARGET_HOST={$host}");
}

$result = VhostOps::show($domain);

if (!$result['success']) {
    fwrite(STDERR, "Error: {$result['error']}\n");
    exit(1);
}

echo "Domain: {$result['domain']}\n";
echo "Home: {$result['home']}\n";
echo "User: {$result['user']} (uid={$result['uid']})\n";
echo "Group: gid={$result['gid']}\n";
echo "Size: {$result['size']}\n";
echo "Nginx: {$result['nginx']}\n";
echo "PHP-FPM: PHP {$result['php']}\n";
echo "Mailboxes: {$result['mailboxes']}\n";
exit(0);
